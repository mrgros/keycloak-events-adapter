# Keycloak Events Adapter

–ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è –ø—Ä–∏–µ–º–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π Keycloak —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ Tarantool.

## üìã –û –ø—Ä–æ–µ–∫—Ç–µ

**keycloak-events-adapter** - —ç—Ç–æ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π Go-—Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π:

- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –æ—Ç Keycloak —á–µ—Ä–µ–∑ gRPC API
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ Tarantool
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ –≤–æ—Ä–∫–µ—Ä–∞–º–∏
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π Keycloak (–±–æ–ª–µ–µ 100 —Ç–∏–ø–æ–≤)

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Å–±–æ—Ä–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∞—É–¥–∏—Ç–æ—Ä—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è Keycloak.

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    Keycloak     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ gRPC
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   gRPC API Server       ‚îÇ
‚îÇ  (Validation, Recovery) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    Event Service        ‚îÇ
‚îÇ  (Business Logic)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚ñº         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇEvents ‚îÇ ‚îÇAdmin  ‚îÇ
‚îÇQueue  ‚îÇ ‚îÇEvents ‚îÇ
‚îÇ(TTL 4h)‚îÇ ‚îÇQueue  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Tarantool     ‚îÇ
‚îÇ  (fifottl queue)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **gRPC API Server** (`internal/api/grpc/`)
   - –†–µ–∞–ª–∏–∑—É–µ—Ç `EventAPI` —Å–µ—Ä–≤–∏—Å
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ protobuf –≤–∞–ª–∏–¥–∞—Ç–æ—Ä
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞–Ω–∏–∫ —á–µ—Ä–µ–∑ middleware
   - gRPC reflection –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

2. **Event Service** (`internal/event.go`)
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤—É–º—è —Ç–∏–ø–∞–º–∏ —Å–æ–±—ã—Ç–∏–π: `Event` –∏ `AdminEvent`
   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≤–æ—Ä–∫–µ—Ä–æ–≤
   - –ì–æ—Ä–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `EventProvider` –¥–ª—è –∏–Ω—ä–µ–∫—Ü–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

3. **Tarantool Storage** (`internal/tarantool/`)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—á–µ—Ä–µ–¥–µ–π Tarantool (`queue` –º–æ–¥—É–ª—å)
   - TTL —Å–æ–æ–±—â–µ–Ω–∏–π: 4 —á–∞—Å–∞
   - –ú–µ—Ö–∞–Ω–∏–∑–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (ack) –∑–∞–¥–∞—á
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á

4. **Protobuf Schemas** (`internal/specs/proto/`)
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 116 —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π Keycloak
   - 4 —Ç–∏–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
   - –°—Ç—Ä—É–∫—Ç—É—Ä—ã: `Event`, `AdminEvent`, `AuthDetails`

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.25+
- Docker & Docker Compose
- Tarantool (–µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –±–µ–∑ Docker)

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/mrgros/keycloak-events-adapter.git
cd keycloak-events-adapter

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up -d
```

–°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É `9999`.

### –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é

```bash
# –°–æ–±–µ—Ä–∏—Ç–µ –±–∏–Ω–∞—Ä–Ω–∏–∫
go build -o keycloak-events-adapter ./cmd/keycloak-events-adapter

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ Tarantool –æ—Ç–¥–µ–ª—å–Ω–æ (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Docker)
docker run -d \
  --name tarantool \
  -p 3301:3301 \
  -v $(pwd)/tarantool:/opt/tarantool \
  tarantool/tarantool:2.10 \
  tarantool /opt/tarantool/init.lua

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–¥–∞–ø—Ç–µ—Ä
./keycloak-events-adapter \
  --log-level=debug \
  --grpc-listen=:9999 \
  --tnt-host=localhost \
  --tnt-port=3301 \
  --tnt-user=test \
  --tnt-password=test
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è |
|------------|----------|--------------|
| `LOG_LEVEL` | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (panic, fatal, error, warn, info, debug) | –î–∞ |
| `LOG_JSON` | –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤: JSON (true) –∏–ª–∏ console (false) | –ù–µ—Ç |
| `GRPC_LISTEN` | –ê–¥—Ä–µ—Å –¥–ª—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è gRPC (—Ñ–æ—Ä–º–∞—Ç: `:–ø–æ—Ä—Ç` –∏–ª–∏ `—Ö–æ—Å—Ç:–ø–æ—Ä—Ç`) | –î–∞ |
| `TNT_HOST` | –•–æ—Å—Ç Tarantool | –î–∞ |
| `TNT_PORT` | –ü–æ—Ä—Ç Tarantool | –î–∞ |
| `TNT_USER` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Tarantool | –î–∞ |
| `TNT_PASSWORD` | –ü–∞—Ä–æ–ª—å Tarantool | –î–∞ |

### –ü—Ä–∏–º–µ—Ä `.env` —Ñ–∞–π–ª–∞

```env
LOG_LEVEL=debug
LOG_JSON=false
GRPC_LISTEN=:9999

TNT_HOST=localhost
TNT_PORT=3301
TNT_USER=test
TNT_PASSWORD=test
```

## üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Keycloak

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Keycloak

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–≥–∏–Ω [keycloak-event-listener-grpc](https://github.com/mrgros/keycloak-events-grpc) (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥)
2. –í –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ Keycloak:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ `Realm Settings` ‚Üí `Events`
   - –í–∫–ª—é—á–∏—Ç–µ `Save events` –¥–ª—è –Ω—É–∂–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `Event Listeners` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ gRPC
3. –£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –∞–¥–∞–ø—Ç–µ—Ä–∞: `localhost:9999`

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π

#### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (EventType)
- Login / Logout (—É—Å–ø–µ—à–Ω—ã–µ –∏ —Å –æ—à–∏–±–∫–∞–º–∏)
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è email
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è, –ø–∞—Ä–æ–ª—è
- –†–∞–±–æ—Ç–∞ —Å —Ç–æ–∫–µ–Ω–∞–º–∏ (refresh, exchange, introspection)
- OAuth2 flows (authorization code, client credentials)
- Federation, impersonation
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏
- –ò –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ (–±–æ–ª–µ–µ 100 —Ç–∏–ø–æ–≤)

#### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (OperationType)
- `CREATE` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞
- `UPDATE` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞
- `DELETE` - —É–¥–∞–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞
- `ACTION` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ê–¥–∞–ø—Ç–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç [Uber Zap](https://github.com/uber-go/zap) –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:

```json
{
  "level": "info",
  "ts": "2024-01-15T10:30:00.000Z",
  "msg": "gRPC started",
  "listen": ":9999"
}
```

### –ú–µ—Ç—Ä–∏–∫–∏

–í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏:
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –æ—á–µ—Ä–µ–¥—è–º–∏
- –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –æ—à–∏–±–æ–∫
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

### Health Checks

gRPC —Å–µ—Ä–≤–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç reflection, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞.

## üõ† –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
keycloak-events-adapter/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ keycloak-events-adapter/  # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ       ‚îú‚îÄ‚îÄ main.go
‚îÇ       ‚îî‚îÄ‚îÄ config.go
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ event.go                  # –î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏ —Å–µ—Ä–≤–∏—Å
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ grpc/                # gRPC —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ server_event.go
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ mapper.go
‚îÇ   ‚îú‚îÄ‚îÄ tarantool/               # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Tarantool
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ event.go
‚îÇ   ‚îî‚îÄ‚îÄ specs/
‚îÇ       ‚îú‚îÄ‚îÄ gen/                 # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ protobuf
‚îÇ       ‚îî‚îÄ‚îÄ proto/               # –ò—Å—Ö–æ–¥–Ω—ã–µ .proto —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ tarantool/
‚îÇ   ‚îî‚îÄ‚îÄ init.lua                 # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Tarantool
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ go.mod
‚îú‚îÄ‚îÄ buf.yaml                      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è buf
‚îî‚îÄ‚îÄ README.md
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è protobuf –∫–æ–¥–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ buf
brew install bufbuild/buf/buf

# –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–æ–¥
buf generate
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
go test ./...
```

### –õ–∏–Ω—Ç–∏–Ω–≥

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ golangci-lint
go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ
golangci-lint run
```

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

| –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|------------|
| `google.golang.org/grpc` | gRPC —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ |
| `github.com/tarantool/go-tarantool` | –ö–ª–∏–µ–Ω—Ç –¥–ª—è Tarantool |
| `go.uber.org/zap` | –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `github.com/jessevdk/go-flags` | –ü–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ |
| `github.com/grpc-ecosystem/go-grpc-middleware/v2` | gRPC middleware |
| `github.com/envoyproxy/protoc-gen-validate` | –í–∞–ª–∏–¥–∞—Ü–∏—è protobuf |

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–º. –≤ `go.mod`.

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ TLS –¥–ª—è gRPC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ production
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ firewall –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ—Ä—Ç–∞–º
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ strong passwords –¥–ª—è Tarantool
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ gRPC –ø–æ—Ä—Ç—É —Ç–æ–ª—å–∫–æ —Å Keycloak —Ö–æ—Å—Ç–æ–≤
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**: –°–æ–±—ã—Ç–∏—è –ø–æ–º–µ—â–∞—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- **TTL**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Å–æ–±—ã—Ç–∏–π (4 —á–∞—Å–∞)
- **–ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ, —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –æ—á–µ—Ä–µ–¥—å—é

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```bash
# –£–≤–µ–ª–∏—á—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
./keycloak-events-adapter \
  # ... –¥—Ä—É–≥–∏–µ —Ñ–ª–∞–≥–∏
  # –í –∫–æ–¥–µ: –∏–∑–º–µ–Ω–∏—Ç–µ numWorkers –≤ main.go
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –í–∫–ª—é—á–µ–Ω–∏–µ debug –ª–æ–≥–æ–≤

```bash
LOG_LEVEL=debug ./keycloak-events-adapter ...
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–µ—Ä–µ–¥–µ–π Tarantool

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ Tarantool
tarantoolctl connect localhost:3301

# –í –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ
box.space.queue:select()
```

### gRPC reflection

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ grpcurl
brew install grpcurl

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
grpcurl -plaintext localhost:9999 list

# –í—ã–∑–æ–≤–∏—Ç–µ –º–µ—Ç–æ–¥ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
grpcurl -plaintext -d '{} localhost:9999 keycloak.event.v1.EventAPI/Create
```

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License. –°–º. —Ñ–∞–π–ª [LICENSE](LICENSE).
